<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sala de Guerra Eleitoral v7.8 - Base de Dados Completa</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'playfair': ['"Playfair Display"', 'serif']
                    },
                    colors: {
                        'primary': '#2563eb', // blue-600
                        'secondary': '#f97316', // orange-500
                        'background': '#0f172a', // slate-900
                        'card': '#1e293b', // slate-800
                        'text-main': '#ffffff', // white
                        'text-light': '#e2e8f0', // slate-200
                        'text-neutral': '#d1d5db', // coolGray-300
                        'border': '#334155', // slate-700
                        'success': '#22c55e', // green-500
                        'danger': '#ef4444', // red-500
                        'warning': '#eab308', // yellow-500
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: tailwind.config.theme.extend.colors.background;
            color: tailwind.config.theme.extend.colors['text-main'];
        }
        input, select {
            color: #ffffff;
        }
        input::placeholder {
            color: #94a3b8; /* slate-400 */
        }
        .number-dynamic {
            transition: color 0.4s ease, transform 0.4s ease;
        }
        .party-bar {
            transition: width 0.5s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .risk-card {
            transition: all 0.3s ease-in-out;
            border-left-width: 4px;
        }
        .clickable { cursor: pointer; transition: background-color 0.2s; }
        .clickable:hover { background-color: #334155; }
        
        /* Modal Styles */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px;}
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        /* Alliance Checkbox */
        .alliance-checkbox:checked + label {
            background-color: #2563eb;
            border-color: #2563eb;
            color: white;
        }
        .tab-button {
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
        }
        .tab-button.active {
            border-bottom-color: #2563eb;
            color: #f1f5f9;
        }
        #logo-adjust-canvas {
            cursor: move;
            border-radius: 50%;
        }

        /* Print Styles */
        @media print {
            body {
                background-color: #ffffff;
                color: #000000;
            }
            header, aside, #content-candidatos, .no-print {
                display: none !important;
            }
            main, #content-simulador, .lg\:col-span-3 {
                display: block !important;
                width: 100% !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            .grid {
                display: block !important;
            }
            .bg-card {
                background-color: #f3f4f6 !important;
                border: 1px solid #d1d5db !important;
                page-break-inside: avoid;
            }
            .text-text-main, .text-text-light, .text-text-neutral, .font-bold {
                color: #000 !important;
            }
            .text-primary { color: #2563eb !important; }
            .text-secondary { color: #f97316 !important; }
            .text-success { color: #22c55e !important; }
            .text-danger { color: #ef4444 !important; }
            .text-warning { color: #eab308 !important; }
        }
    </style>
</head>
<body class="antialiased">
    <div class="min-h-screen">
        <!-- Cabeçalho -->
        <header class="bg-card/50 backdrop-blur-sm sticky top-0 z-20 border-b border-border">
            <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-3 relative flex justify-center items-center">
                 <div id="logo-container" class="absolute left-4 top-1/2 -translate-y-1/2 flex flex-col items-center w-28 cursor-pointer group">
                    <img id="logo-img" src="https://i.imgur.com/uY34Y3A.jpeg" alt="Logo Silmara Miguel" class="h-16 w-16 rounded-full object-cover border-2 border-primary group-hover:opacity-80 transition-opacity">
                    <input type="file" id="logo-upload" class="hidden" accept="image/*">
                    <p class="font-playfair font-bold text-sm text-text-main mt-2 text-center">Silmara Miguel</p>
                </div>
                <div class="text-center">
                    <h1 class="text-2xl font-bold text-text-main">
                        <i class="fa-solid fa-chess-rook text-primary mr-2"></i>Sala de Guerra Eleitoral <span class="text-primary text-sm font-mono">v7.8</span>
                    </h1>
                    <p class="text-text-light text-sm">Análise e Simulação de Cenários Eleitorais - SC 2026</p>
                </div>
                <div class="absolute right-4 top-1/2 -translate-y-1/2 no-print">
                    <button onclick="printReport()" class="bg-primary hover:bg-blue-500 text-white font-bold py-2 px-4 rounded-lg flex items-center">
                        <i class="fa-solid fa-print mr-2"></i> Imprimir Relatório
                    </button>
                </div>
            </div>
            <!-- Navegação Principal -->
            <nav class="max-w-screen-2xl mx-auto flex justify-center items-center space-x-4 sm:space-x-8" id="main-tabs">
                <button class="tab-button active font-semibold py-3 px-2 sm:px-4" onclick="changeTab('simulador')"><i class="fa-solid fa-sliders mr-2"></i>Simulador de Cenário</button>
                <button class="tab-button font-semibold py-3 px-2 sm:px-4 text-text-light" onclick="changeTab('candidatos')"><i class="fa-solid fa-users mr-2"></i>Base de Candidatos 2022</button>
            </nav>
        </header>

        <main class="max-w-screen-2xl mx-auto p-4 sm:p-6 lg:p-8">
            <!-- ABA: SIMULADOR -->
            <div id="content-simulador">
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                    <!-- Painel de Controle -->
                    <aside class="lg:col-span-1 space-y-6 no-print">
                        <!-- PAINEL CENÁRIO ATUAL -->
                        <div class="bg-card p-5 rounded-lg border border-border">
                            <h2 class="text-lg font-bold mb-4 text-secondary"><i class="fa-solid fa-chart-pie mr-2"></i>Cenário Atual</h2>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="bg-background p-3 rounded-lg text-center">
                                    <p class="text-xs font-semibold text-text-light uppercase truncate">Votos Válidos</p>
                                    <p id="summary-vv" class="text-xl font-bold text-success">0</p>
                                </div>
                                <div class="bg-background p-3 rounded-lg text-center">
                                    <p class="text-xs font-semibold text-text-light uppercase truncate">Quociente</p>
                                    <p id="summary-qe" class="text-xl font-bold text-primary">0</p>
                                </div>
                                <div class="bg-background p-3 rounded-lg text-center">
                                    <p class="text-xs font-semibold text-text-light uppercase truncate">Votos Brancos</p>
                                    <p id="summary-vb" class="text-xl font-bold text-text-neutral">0</p>
                                </div>
                                <div class="bg-background p-3 rounded-lg text-center">
                                    <p class="text-xs font-semibold text-text-light uppercase truncate">Votos Nulos</p>
                                    <p id="summary-vn" class="text-xl font-bold text-text-neutral">0</p>
                                </div>
                                <div class="bg-background p-3 rounded-lg text-center">
                                    <p class="text-xs font-semibold text-text-light uppercase truncate">Nota Corte</p>
                                    <p id="summary-nc" class="text-xl font-bold text-warning">0</p>
                                </div>
                                <div class="bg-background p-3 rounded-lg text-center">
                                    <p class="text-xs font-semibold text-text-light uppercase truncate">Em Risco</p>
                                    <p id="summary-vr" class="text-xl font-bold text-danger">0</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-card p-5 rounded-lg border border-border">
                            <h2 class="text-lg font-bold mb-4 text-secondary"><i class="fa-solid fa-sliders mr-2"></i>Painel de Controle do Cenário</h2>
                            <div class="space-y-4">
                                <div>
                                    <label for="abstention-rate" class="block text-sm font-medium text-text-light mb-1">Taxa de Abstenção</label>
                                    <input type="range" id="abstention-rate" min="15" max="30" value="18.6" step="0.1" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer" oninput="updateScenario()">
                                    <div class="flex justify-between items-center mt-1">
                                        <span class="text-xs text-text-light">Base 2022: <span id="base-abstention-display" class="font-mono"></span>%</span>
                                        <span class="text-sm font-mono text-primary"><span id="abstention-value">18.6</span>%</span>
                                    </div>
                                </div>
                                <div>
                                    <label for="electorate-growth" class="block text-sm font-medium text-text-light mb-1">Crescimento do Eleitorado</label>
                                    <input type="range" id="electorate-growth" min="-10" max="10" value="0" step="0.1" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer" oninput="updateScenario()">
                                     <div class="flex justify-between items-center mt-1">
                                        <span class="text-xs text-text-light">Base 2022: <span id="base-electorate-display" class="font-mono"></span></span>
                                        <span class="text-sm font-mono text-primary"><span id="electorate-growth-value">0.0</span>%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-card p-5 rounded-lg border border-border">
                            <h2 class="text-lg font-bold mb-4 text-secondary"><i class="fa-solid fa-chart-line mr-2"></i>Impulso de Campanha</h2>
                            <div id="party-boost-container" class="space-y-3 max-h-60 overflow-y-auto pr-2"></div>
                        </div>
                        <div class="bg-card p-5 rounded-lg border border-border">
                            <h2 class="text-lg font-bold mb-4 text-secondary"><i class="fa-solid fa-handshake mr-2"></i>Simulador de Alianças</h2>
                            <p class="text-xs text-text-light mb-3">Selecione 2 ou mais partidos para analisar uma possível coligação.</p>
                            <div id="alliance-party-container" class="flex flex-wrap gap-2 mb-4"></div>
                            <button id="alliance-button" onclick="simularAlianca()" class="w-full bg-primary text-white font-bold py-2 rounded-lg shadow-md hover:bg-blue-500 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                Analisar Aliança
                            </button>
                        </div>
                        <div class="bg-card p-5 rounded-lg border border-border">
                            <h2 class="text-lg font-bold mb-4 text-secondary"><i class="fa-solid fa-user-pen mr-2"></i>Editor de Legendas</h2>
                            <p class="text-xs text-text-light mb-3">Crie legendas personalizadas para testar cenários específicos.</p>
                            <button onclick="openLegendaEditor()" class="w-full bg-secondary text-white font-bold py-2 rounded-lg shadow-md hover:bg-orange-400 transition-all duration-200">
                                Abrir Editor
                            </button>
                        </div>
                    </aside>

                    <!-- Dashboard Principal -->
                    <section class="lg:col-span-3 space-y-8">
                        <!-- Distribuição de Vagas e Cadeiras em Risco -->
                        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                            <div class="bg-card p-6 rounded-lg border border-border">
                                <h2 class="text-xl font-bold mb-4">Ranking de Oportunidade</h2>
                                <div id="vagas-dist-container" class="space-y-2"></div>
                            </div>
                            <div class="bg-card p-6 rounded-lg border border-border flex flex-col">
                                <h2 class="text-xl font-bold mb-4 text-danger"><i class="fa-solid fa-fire-flame-curved"></i>Cadeiras em Risco</h2>
                                <div id="risk-container" class="space-y-4 flex-grow overflow-y-auto pr-2"></div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            
            <!-- ABA: BASE DE CANDIDATOS -->
            <div id="content-candidatos" class="hidden">
                 <div class="bg-card p-6 rounded-lg border border-border">
                    <h2 class="text-2xl font-bold mb-4">Base de Candidatos (Eleições 2022)</h2>
                    <div class="mb-6">
                        <input type="text" id="candidato-search" placeholder="Pesquisar por nome do candidato..." class="w-full p-3 bg-slate-900/50 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition">
                    </div>
                    <div id="candidatos-accordion-container" class="space-y-2">
                        <!-- Accordion será gerado aqui -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Genérico -->
    <div id="modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div id="modal-overlay" class="absolute inset-0 bg-black/70 modal-overlay" onclick="closeModal()"></div>
        <div id="modal-content" class="bg-card border border-border rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto relative modal-content">
            <!-- Conteúdo do Modal será injetado aqui -->
        </div>
    </div>

    <!-- Modal de Edição de Logo -->
    <div id="logo-editor-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden no-print">
        <div class="absolute inset-0 bg-black/70" onclick="closeLogoEditor()"></div>
        <div class="bg-card border border-border rounded-lg shadow-2xl w-full max-w-md p-6 relative">
            <h2 class="text-xl font-bold mb-4">Ajustar Imagem</h2>
            <div class="flex justify-center mb-4">
                <canvas id="logo-adjust-canvas" width="250" height="250" class="bg-slate-700"></canvas>
            </div>
            <div class="space-y-4">
                <div>
                    <label for="logo-zoom" class="block text-sm font-medium text-text-light mb-1">Zoom</label>
                    <input type="range" id="logo-zoom" min="0.1" max="3" value="1" step="0.05" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button onclick="closeLogoEditor()" class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600">Cancelar</button>
                <button onclick="saveLogo()" class="px-4 py-2 rounded-lg bg-primary hover:bg-blue-500 font-bold">Salvar</button>
            </div>
        </div>
    </div>


    <script>
    // =================================================================================
    // DADOS E CONFIGURAÇÕES
    // =================================================================================
    const DADOS_ELEICOES = { 'SC': { 'de': { vagas: 40, historico: [ { ano: 2022, eleitorado: 5495133, votos_validos: 4028852, votos_brancos: 289065, votos_nulos: 153702, abstencao: 0.1862, partidos: { 
        'PL': { votos: 878708, candidatos: [ { nome: 'Ana Campagnolo', votos: 196571, isEleito: true }, { nome: 'Sargento Lima', votos: 71185, isEleito: true }, { nome: 'Mauricio Eskudlark', votos: 65638, isEleito: true }, { nome: 'Jessé Lopes', votos: 55013, isEleito: true }, { nome: 'Carlos Humberto', votos: 46445, isEleito: true }, { nome: 'Ivan Naatz', votos: 45304, isEleito: true }, { nome: 'Berlanda', votos: 41488, isEleito: true }, { nome: 'Marcius Machado', votos: 39749, isEleito: true }, { nome: 'Massocco', votos: 31659, isEleito: true }, { nome: 'Oscar Gutz', votos: 26812, isEleito: true }, { nome: 'Soratto', votos: 25622, isEleito: true }, { nome: 'Maurício Peixer', votos: 22028, isEleito: false }, { nome: 'A Alex Brasil', votos: 20271, isEleito: false }, { nome: 'Jeferson Cardozo Canal Atalaia', votos: 17934, isEleito: false }, { nome: 'Rafael Laske - Mamão', votos: 15730, isEleito: false }, { nome: 'Frigo', votos: 15090, isEleito: false }, { nome: 'Leticia Mattos', votos: 11068, isEleito: false }, { nome: 'Dr. Jorge', votos: 8810, isEleito: false }, { nome: 'Neuri Mantelli', votos: 8484, isEleito: false }, { nome: 'Turibio Torres', votos: 7282, isEleito: false }, { nome: 'Alemãozinho - Claudir Henz', votos: 6893, isEleito: false }, { nome: 'Marcio Cardoso', votos: 5990, isEleito: false }, { nome: 'Roberto Salum', votos: 5082, isEleito: false }, { nome: 'Andresa Ribeiro', votos: 5071, isEleito: false }, { nome: 'A Guerreira Salete Cardoso', votos: 4829, isEleito: false }, { nome: 'Rabuja', votos: 4799, isEleito: false }, { nome: 'Maryanne Mattos', votos: 4420, isEleito: false }, { nome: 'Alex Wehrle Professor', votos: 3999, isEleito: false }, { nome: 'Eloir Dedonatti', votos: 3958, isEleito: false }, { nome: 'Enfermeiro Victor Nascimento', votos: 3700, isEleito: false }, { nome: 'Moacir Bertoldi', votos: 3688, isEleito: false }, { nome: 'Simone Lerner', votos: 2810, isEleito: false }, { nome: 'Leonardo Tatim', votos: 1650, isEleito: false }, { nome: 'Professor Hahne', votos: 1332, isEleito: false }, { nome: 'Odete Enfermeira', votos: 564, isEleito: false }, { nome: 'Engenheira Alessandra Kingeski', votos: 515, isEleito: false }, { nome: 'Betinha Thomaselli', votos: 506, isEleito: false }, { nome: 'Sueli Zincoski', votos: 407, isEleito: false }, { nome: 'Marta Efrayim', votos: 135, isEleito: false }, { nome: 'Silvana', votos: 112, isEleito: false } ] }, 
        'MDB': { votos: 505571, candidatos: [ { nome: 'Antídio Lunelli', votos: 74500, isEleito: true }, { nome: 'Mauro de Nadal', votos: 67065, isEleito: true }, { nome: 'Jerry Comper', votos: 64145, isEleito: true }, { nome: 'Fernando Krelling', votos: 54320, isEleito: true }, { nome: 'Volnei Weber', votos: 45995, isEleito: true }, { nome: 'Tiago Zilli', votos: 33733, isEleito: true }, { nome: 'Emerson Stein', votos: 25063, isEleito: false }, { nome: 'Rosi Maldaner', votos: 20189, isEleito: false }, { nome: 'Dirce Heiderscheidt', votos: 16906, isEleito: false }, { nome: 'Adilson Girardi', votos: 15943, isEleito: false }, { nome: 'Cleiton Fossa', votos: 12364, isEleito: false }, { nome: 'Paulo Basilio', votos: 10561, isEleito: false }, { nome: 'Carelli', votos: 10138, isEleito: false }, { nome: 'Suelen Geremia', votos: 4825, isEleito: false }, { nome: 'Marcelo Fett', votos: 4552, isEleito: false }, { nome: 'Ari Galeski', votos: 4473, isEleito: false }, { nome: 'Guella', votos: 3743, isEleito: false }, { nome: 'Juarez Matos', votos: 3602, isEleito: false }, { nome: 'Flávia Vicente', votos: 2943, isEleito: false }, { nome: 'Professor Toldo', votos: 2027, isEleito: false }, { nome: 'William', votos: 1685, isEleito: false }, { nome: 'Leila Conci', votos: 1502, isEleito: false }, { nome: 'Psicóloga Ronize Ferreira', votos: 1478, isEleito: false }, { nome: 'Mano Cadore', votos: 1359, isEleito: false }, { nome: 'Chico Bento', votos: 1089, isEleito: false }, { nome: 'Micheline', votos: 803, isEleito: false }, { nome: 'Biriba', votos: 553, isEleito: false }, { nome: 'Jairo Santos', votos: 292, isEleito: false }, { nome: 'Franciel Britos', votos: 233, isEleito: false }, { nome: 'Mairi', votos: 110, isEleito: false }, { nome: 'Zélia Grah', votos: 71, isEleito: false }, { nome: 'Keli Cordeiro', votos: 42, isEleito: false } ] }, 
        'PT': { votos: 438030, candidatos: [ { nome: 'Luciane Carminatti', votos: 92478, isEleito: true }, { nome: 'Neodi Saretta', votos: 38729, isEleito: true }, { nome: 'Fabiano da Luz', votos: 34972, isEleito: true }, { nome: 'Padre Pedro', votos: 26803, isEleito: true }, { nome: 'Professora Vanessa da Rosa', votos: 16832, isEleito: false }, { nome: 'Paulo Eccel', votos: 16561, isEleito: false }, { nome: 'Dirceu Dresch', votos: 14370, isEleito: false }, { nome: 'Rodrigo Preis', votos: 12844, isEleito: false }, { nome: 'Luci Choinacki', votos: 12699, isEleito: false }, { nome: 'Jean Volpato', votos: 12499, isEleito: false }, { nome: 'Adriano Pereira', votos: 10988, isEleito: false }, { nome: 'Celso Zuchi', votos: 9159, isEleito: false }, { nome: 'Professor Lino Peres', votos: 8619, isEleito: false }, { nome: 'Rodolfo de Ramos', votos: 8128, isEleito: false }, { nome: 'Marisa Zanoni', votos: 7826, isEleito: false }, { nome: 'Dani Coletivo Juventude', votos: 7752, isEleito: false }, { nome: 'Júlio Bittencourt', votos: 7495, isEleito: false }, { nome: 'Célio Elias', votos: 6938, isEleito: false }, { nome: 'Adriana Rossi', votos: 6188, isEleito: false }, { nome: 'Professor Alessandro', votos: 5404, isEleito: false }, { nome: 'Cléo Comunello', votos: 5171, isEleito: false }, { nome: 'Glauter', votos: 4070, isEleito: false }, { nome: 'Vanda Pinedo Nossa Força e Voz', votos: 3978, isEleito: false }, { nome: 'Matheus Madeira', votos: 3853, isEleito: false }, { nome: 'Professor Raul Ribas', votos: 3822, isEleito: false }, { nome: 'Rodrigo de Oliveira', votos: 3730, isEleito: false }, { nome: 'Claudia Bratti', votos: 3425, isEleito: false }, { nome: 'Tomio', votos: 2396, isEleito: false }, { nome: 'Valmor de Paula', votos: 2311, isEleito: false }, { nome: 'Sérgio', votos: 2279, isEleito: false }, { nome: 'Professor Chico do Sinte', votos: 2257, isEleito: false }, { nome: 'Gislaine Durski', votos: 2237, isEleito: false }, { nome: 'Elvira Manfroi', votos: 2219, isEleito: false }, { nome: 'Rafael Coletivo Feliz de Novo', votos: 1047, isEleito: false }, { nome: 'Cláudio Márcio', votos: 547, isEleito: false } ] }, 
        'PSD': { votos: 293675, candidatos: [ { nome: 'Mario Motta', votos: 56363, isEleito: true }, { nome: 'Julio Garcia', votos: 49958, isEleito: true }, { nome: 'Napoleão Bernardes', votos: 36923, isEleito: true }, { nome: 'Zé Caramori', votos: 24394, isEleito: false }, { nome: 'Gerri da Consoli', votos: 22668, isEleito: false }, { nome: 'Silvio Alexandre Zancanaro', votos: 19672, isEleito: false }, { nome: 'Adeliana Dal Pont', votos: 18484, isEleito: false }, { nome: 'Polaco', votos: 9719, isEleito: false }, { nome: 'Wellington', votos: 8381, isEleito: false }, { nome: 'Mario Marcondes', votos: 7739, isEleito: false }, { nome: 'Gerson', votos: 3265, isEleito: false }, { nome: 'Carla Hofmann', votos: 3014, isEleito: false }, { nome: 'Arlindo Cruz', votos: 2559, isEleito: false }, { nome: 'Coronel Vonk', votos: 2352, isEleito: false }, { nome: 'Bete Werner Quandt', votos: 2037, isEleito: false }, { nome: 'Deyvid Breis Boca Aberta', votos: 1369, isEleito: false }, { nome: 'Sargento Stoklosa', votos: 1217, isEleito: false }, { nome: 'Helenice Pereira Duarte', votos: 1056, isEleito: false }, { nome: 'Cláudio Motoboy do Coletivo SC', votos: 1054, isEleito: false }, { nome: 'Ciro Girardi', votos: 995, isEleito: false }, { nome: 'Marcia Badalotti', votos: 801, isEleito: false }, { nome: 'Voltolini Taxista', votos: 736, isEleito: false }, { nome: 'Inajara Rodrigues', votos: 589, isEleito: false }, { nome: 'Henrique Ávila', votos: 382, isEleito: false }, { nome: 'Isa Simas', votos: 151, isEleito: false }, { nome: 'Katielly Lanzini', votos: 53, isEleito: false } ] },
        'PP': { votos: 280551, candidatos: [ { nome: 'Zé Milton', votos: 56585, isEleito: true }, { nome: 'Altair Silva', votos: 46086, isEleito: true }, { nome: 'Pepê Collaço', votos: 28809, isEleito: true }, { nome: 'Pedrão', votos: 27344, isEleito: false }, { nome: 'João Amin', votos: 19154, isEleito: false }, { nome: 'Luizinho da Regional', votos: 15324, isEleito: false }, { nome: 'Fernando Cruzzetta', votos: 10650, isEleito: false }, { nome: 'Anelisio da Assessoritec', votos: 9848, isEleito: false }, { nome: 'Almir Vieira', votos: 9390, isEleito: false }, { nome: 'Magno Bollmann', votos: 9278, isEleito: false }, { nome: 'Maurilio Moraes', votos: 7981, isEleito: false }, { nome: 'Cattoni', votos: 4789, isEleito: false }, { nome: 'Diego Pandini Diabo Loiro', votos: 4700, isEleito: false }, { nome: 'Mara da Saúde', votos: 4654, isEleito: false }, { nome: 'Julio Kaminski', votos: 3546, isEleito: false }, { nome: 'Gaúcho Amarelo', votos: 3537, isEleito: false }, { nome: 'Douglas Steffen Contador', votos: 2516, isEleito: false }, { nome: 'Katsumi', votos: 2506, isEleito: false }, { nome: 'Manjuva Caminhoneiro', votos: 1395, isEleito: false }, { nome: 'Giovana Menegotto', votos: 1325, isEleito: false }, { nome: 'Simone Andrade', votos: 704, isEleito: false }, { nome: 'Paulinha do Big Lojão', votos: 697, isEleito: false }, { nome: 'Adri Joias', votos: 404, isEleito: false }, { nome: 'Eneida Pereira', votos: 398, isEleito: false }, { nome: 'Professora Rosa Maria Tesser', votos: 370, isEleito: false }, { nome: 'Cabo Camargo', votos: 344, isEleito: false }, { nome: 'Mabel Ziegler', votos: 228, isEleito: false }, { nome: 'João Mira Taxista', votos: 191, isEleito: false }, { nome: 'Luciano Niua', votos: 90, isEleito: false }, { nome: 'Mari Rieke', votos: 54, isEleito: false }, { nome: 'Jaques Rodrigues', votos: 16, isEleito: false } ] },
        'UNIÃO': { votos: 265764, candidatos: [ { nome: 'Jair Miotto', votos: 33682, isEleito: true }, { nome: 'Repórter Sérgio Guimarães', votos: 27977, isEleito: true }, { nome: 'Marcos da Rosa', votos: 25845, isEleito: true }, { nome: 'Laércio Schuster', votos: 24605, isEleito: false }, { nome: 'Constancio Maciel', votos: 23614, isEleito: false }, { nome: 'Márcio Burigo', votos: 15296, isEleito: false }, { nome: 'Felipe Estevão', votos: 15146, isEleito: false }, { nome: 'Dr João', votos: 12169, isEleito: false }, { nome: 'Tânia Larson', votos: 11556, isEleito: false }, { nome: 'Mauro Dresch', votos: 9424, isEleito: false }, { nome: 'Sidney Sabel', votos: 7295, isEleito: false }, { nome: 'Jaime Pasqualini', votos: 5857, isEleito: false }, { nome: 'Lioilson', votos: 5502, isEleito: false }, { nome: 'Nadir Bau', votos: 5453, isEleito: false }, { nome: 'Samuel Ramos', votos: 4557, isEleito: false }, { nome: 'Sub Tenente Wancarlos', votos: 3873, isEleito: false }, { nome: 'Abrahão Mussi', votos: 3126, isEleito: false }, { nome: 'Ezequiel de Souza', votos: 3081, isEleito: false }, { nome: 'Aa ST Veterana Margareth Prats', votos: 2650, isEleito: false }, { nome: 'Paulo Zwiefka', votos: 2306, isEleito: false }, { nome: 'Mari Schorr', votos: 2292, isEleito: false }, { nome: 'Professor Arlindo', votos: 1623, isEleito: false }, { nome: 'Fernando Amorim', votos: 1458, isEleito: false }, { nome: 'Sandro Fortes', votos: 1446, isEleito: false }, { nome: 'Ivan da Luz', votos: 1294, isEleito: false }, { nome: 'Cris da Saúde', votos: 1257, isEleito: false }, { nome: 'Luciano Camargo', votos: 1254, isEleito: false }, { nome: 'Nina', votos: 1034, isEleito: false }, { nome: 'Cleuse Soares', votos: 958, isEleito: false }, { nome: 'Mauro Goedert', votos: 857, isEleito: false }, { nome: 'Youtuber Gabriela Zamboni', votos: 562, isEleito: false }, { nome: 'Luis Olavo Nandi', votos: 521, isEleito: false }, { nome: 'Xuxa', votos: 504, isEleito: false }, { nome: 'Xandi da Toca', votos: 497, isEleito: false }, { nome: 'Márcia Gueno', votos: 398, isEleito: false }, { nome: 'Edilberto Santos', votos: 223, isEleito: false }, { nome: 'Bia Machado', votos: 144, isEleito: false }, { nome: 'Eliana Patriota', votos: 58, isEleito: false }, { nome: 'Arlene Ramon', votos: 32, isEleito: false } ] }, 
        'PODE': { votos: 237137, candidatos: [ { nome: 'Paulinha', votos: 58694, isEleito: true }, { nome: 'Camilo Martins', votos: 44925, isEleito: true }, { nome: 'Lucas Neves', votos: 23053, isEleito: true }, { nome: 'Daniel Candido', votos: 20110, isEleito: false }, { nome: 'Thiago Morastoni', votos: 19914, isEleito: false }, { nome: 'Janice Krasniak', votos: 12965, isEleito: false }, { nome: 'Rodrigo Fachini', votos: 12649, isEleito: false }, { nome: 'Gabrielzinho', votos: 11578, isEleito: false }, { nome: 'Dra Celina Dittrich', votos: 7279, isEleito: false }, { nome: 'Dentinho', votos: 6311, isEleito: false }, { nome: 'Enfermeiro Pablo', votos: 5477, isEleito: false }, { nome: 'Tiago Maestri', votos: 2403, isEleito: false }, { nome: 'Camila Nascimento', votos: 2062, isEleito: false }, { nome: 'Alessandra Pires', votos: 1608, isEleito: false }, { nome: 'Lucelma Baldi', votos: 1332, isEleito: false }, { nome: 'Rafael Mello', votos: 1085, isEleito: false }, { nome: 'Igor Araujo', votos: 471, isEleito: false }, { nome: 'Baiano', votos: 375, isEleito: false }, { nome: 'Francisco Nunes', votos: 81, isEleito: false }, { nome: 'Dr Cabral', votos: 40, isEleito: false } ] }, 
        'PSDB': { votos: 211208, candidatos: [ { nome: 'Marcos Vieira', votos: 48466, isEleito: true }, { nome: 'Dr. Vicente', votos: 39797, isEleito: true }, { nome: 'Acélio Casagrande', votos: 39032, isEleito: false }, { nome: 'Saulo Sperotto', votos: 28114, isEleito: false }, { nome: 'Anna Carolina Martins', votos: 18325, isEleito: false }, { nome: 'Professora Suzana', votos: 7799, isEleito: false }, { nome: 'Aroldo Frigo Junior', votos: 6342, isEleito: false }, { nome: 'Jens Mantau', votos: 5071, isEleito: false }, { nome: 'Giovana Galato', votos: 4824, isEleito: false }, { nome: 'Soraya Michels', votos: 2230, isEleito: false }, { nome: 'Márcio Pereira', votos: 1966, isEleito: false }, { nome: 'Dejair Teixeira', votos: 1667, isEleito: false }, { nome: 'Izaias Machado', votos: 542, isEleito: false }, { nome: 'Jackson Lucian', votos: 425, isEleito: false }, { nome: 'Bastião Vieira', votos: 400, isEleito: false }, { nome: 'Daniela Sebben', votos: 166, isEleito: false }, { nome: 'Dra. Gabryella Baptista', votos: 105, isEleito: false } ] }, 
        'REPU': { votos: 163410, candidatos: [ { nome: 'Sergio Motta', votos: 44666, isEleito: true }, { nome: 'Leandro Lima', votos: 16572, isEleito: false }, { nome: 'Egídio Beckhauser', votos: 16123, isEleito: false }, { nome: 'Edson Piriquto', votos: 14472, isEleito: false }, { nome: 'Edilene', votos: 14098, isEleito: false }, { nome: 'Renê', votos: 10654, isEleito: false }, { nome: 'Luciano Buligon', votos: 9965, isEleito: false }, { nome: 'Dr. André Motta', votos: 7131, isEleito: false }, { nome: 'Otto Quintino', votos: 6891, isEleito: false }, { nome: 'Jefferson Monteiro', votos: 5326, isEleito: false }, { nome: 'Altamir Montibeller', votos: 4645, isEleito: false }, { nome: 'Zé Dresch', votos: 4237, isEleito: false }, { nome: 'Motinha', votos: 3791, isEleito: false }, { nome: 'Coronel Vieira', votos: 3736, isEleito: false }, { nome: 'Sargento Floriano', votos: 2536, isEleito: false }, { nome: 'Marcio Tinte', votos: 2316, isEleito: false }, { nome: 'Samira Porto', votos: 1451, isEleito: false }, { nome: 'Jeferson Petry', votos: 985, isEleito: false }, { nome: 'Silvinho da Farmácia', votos: 676, isEleito: false }, { nome: 'Ney', votos: 519, isEleito: false }, { nome: 'Sgt Ari', votos: 513, isEleito: false }, { nome: 'Clovis Kruger', votos: 402, isEleito: false }, { nome: 'Emilene Jacomelli', votos: 334, isEleito: false }, { nome: 'Juliana Cardoso', votos: 329, isEleito: false }, { nome: 'Nara Simão', votos: 316, isEleito: false }, { nome: 'Lívia Oliveira', votos: 263, isEleito: false }, { nome: 'Rosana da Silva', votos: 247, isEleito: false }, { nome: 'Jhenniffer Breenstup', votos: 144, isEleito: false }, { nome: 'Mirian Avila', votos: 104, isEleito: false } ] }, 
        'NOVO': { votos: 136632, candidatos: [ { nome: 'Matheus Cadorin', votos: 12390, isEleito: true }, { nome: 'André de Oliveira', votos: 12165, isEleito: false }, { nome: 'Lucas Gotardo', votos: 10947, isEleito: false }, { nome: 'Bruno Win', votos: 8555, isEleito: false }, { nome: 'Murilo Schmitz', votos: 8005, isEleito: false }, { nome: 'Dadá Westphal', votos: 7522, isEleito: false }, { nome: 'Rafael Ary', votos: 6694, isEleito: false }, { nome: 'Isadora Piana', votos: 6674, isEleito: false }, { nome: 'Marcos Zanella', votos: 6397, isEleito: false }, { nome: 'Celso Strobel', votos: 5430, isEleito: false }, { nome: 'André Casagrande', votos: 5378, isEleito: false }, { nome: 'Day Borges', votos: 4947, isEleito: false }, { nome: 'Leandro Schmöckel Gonçalves', votos: 3801, isEleito: false }, { nome: 'Sabino', votos: 2702, isEleito: false }, { nome: 'Bia Borges', votos: 2553, isEleito: false }, { nome: 'Stevan Arcari (Tangará)', votos: 2532, isEleito: false }, { nome: 'Débora Pierini', votos: 2274, isEleito: false }, { nome: 'Jussara Isabel Tumelero', votos: 2173, isEleito: false }, { nome: 'Maria Fernanda Gatti', votos: 2155, isEleito: false }, { nome: 'Fernando Torquato', votos: 2154, isEleito: false }, { nome: 'Luzia Frohlich', votos: 1894, isEleito: false }, { nome: 'Yordan Gums', votos: 1887, isEleito: false }, { nome: 'Eduardo Sávio', votos: 1676, isEleito: false }, { nome: 'Giovane Ferreira', votos: 1671, isEleito: false }, { nome: 'Orides Neto', votos: 1530, isEleito: false }, { nome: 'Indi Herbert', votos: 912, isEleito: false }, { nome: 'Dalva Pazin Vencato', votos: 567, isEleito: false }, { nome: 'Fabricio Favoretto', votos: 548, isEleito: false }, { nome: 'Professora Eliane', votos: 495, isEleito: false }, { nome: 'Lindomar Fróes', votos: 260, isEleito: false }, { nome: 'Rafael Ricardo', votos: 249, isEleito: false } ] }, 
        'PTB': { votos: 96767, candidatos: [ { nome: 'Delegado Egidio Ferrari', votos: 34912, isEleito: true }, { nome: 'Junior Cardoso', votos: 14748, isEleito: false }, { nome: 'Jonata Mendes', votos: 4169, isEleito: false }, { nome: 'Sales', votos: 3300, isEleito: false }, { nome: 'Anselmini', votos: 3105, isEleito: false }, { nome: 'Luciane Stobe', votos: 3036, isEleito: false }, { nome: 'Policial Miriam Lago', votos: 2668, isEleito: false }, { nome: 'Tia Gisele', votos: 2527, isEleito: false }, { nome: 'Juliano Martins', votos: 2492, isEleito: false }, { nome: 'João Cechinel', votos: 2265, isEleito: false }, { nome: 'Marcelindo Gruner', votos: 1776, isEleito: false }, { nome: 'Levi da Pesca', votos: 1462, isEleito: false }, { nome: 'Miriã de Schroeder', votos: 1272, isEleito: false }, { nome: 'Eduardo Bastos', votos: 1205, isEleito: false }, { nome: 'Pastor Paulo', votos: 1107, isEleito: false }, { nome: 'Marcos Angioletti Coca', votos: 1064, isEleito: false }, { nome: 'Antoninho Caminhoneiro', votos: 1019, isEleito: false }, { nome: 'Mirna Bublitz', votos: 919, isEleito: false }, { nome: 'Cláudia Lindner', votos: 884, isEleito: false }, { nome: 'Sargento Appel', votos: 618, isEleito: false }, { nome: 'Carlito o Amigo do Povo', votos: 401, isEleito: false }, { nome: 'Adriana Miguel', votos: 390, isEleito: false }, { nome: 'Enfermeiro Digo Vargas', votos: 372, isEleito: false }, { nome: 'Will Martello', votos: 364, isEleito: false }, { nome: 'Girson Caminhoneiro', votos: 363, isEleito: false }, { nome: 'Evaldino Leite', votos: 215, isEleito: false }, { nome: 'Gel Fadel', votos: 203, isEleito: false }, { nome: 'Maicon Zabot', votos: 174, isEleito: false }, { nome: 'Tatiana Melo', votos: 172, isEleito: false }, { nome: 'Prof Clayton Benites Moita', votos: 135, isEleito: false }, { nome: 'Daniel Ferreira', votos: 111, isEleito: false }, { nome: 'Bruno Santos', votos: 67, isEleito: false }, { nome: 'Mary Marques', votos: 50, isEleito: false }, { nome: 'Lauren Borges', votos: 50, isEleito: false } ] }, 
        'PSB': { votos: 92851, candidatos: [ { nome: 'Juliano Campos', votos: 18816, isEleito: false }, { nome: 'Julio Ronconi', votos: 13341, isEleito: false }, { nome: 'Paulinho Weiss', votos: 8953, isEleito: false }, { nome: 'Enfermeiro Gelson Albuquerque', votos: 4371, isEleito: false }, { nome: 'Renato Ladiada', votos: 4290, isEleito: false }, { nome: 'Decândido Magrão', votos: 3473, isEleito: false }, { nome: 'Professora Caren Machado', votos: 3149, isEleito: false }, { nome: 'Margareth Hernandes', votos: 1792, isEleito: false }, { nome: 'João Rinaldi', votos: 1654, isEleito: false }, { nome: 'Thais Fettback', votos: 1503, isEleito: false }, { nome: 'Brezola', votos: 1494, isEleito: false }, { nome: 'Delegado Thomé', votos: 1372, isEleito: false }, { nome: 'Devides Jean Rossi', votos: 1238, isEleito: false }, { nome: 'Dani Carneiro', votos: 1056, isEleito: false }, { nome: 'Eliane Ramos', votos: 1004, isEleito: false }, { nome: 'Lizete Contin', votos: 469, isEleito: false }, { nome: 'Julça', votos: 460, isEleito: false }, { nome: 'Dalva Assini', votos: 446, isEleito: false }, { nome: 'Antonio Carlos', votos: 326, isEleito: false }, { nome: 'Francine Canto', votos: 286, isEleito: false }, { nome: 'Rodrigo Duarte', votos: 157, isEleito: false }, { nome: 'Lorelone L. da Silva', votos: 154, isEleito: false }, { nome: 'Fred', votos: 146, isEleito: false }, { nome: 'Professor Osni Wagner', votos: 106, isEleito: false }, { nome: 'Rudi', votos: 106, isEleito: false }, { nome: 'Evandro Agostini', votos: 11, isEleito: false } ] }, 
        'PATRI': { votos: 88159, candidatos: [ { nome: 'Dr. Jonas', votos: 18296, isEleito: false }, { nome: 'Marcelo Brick', votos: 14444, isEleito: false }, { nome: 'Rafael Ramthun', votos: 13971, isEleito: false }, { nome: 'Professor Gilson', votos: 8322, isEleito: false }, { nome: 'Coronel Jeferson Schmidt', votos: 4444, isEleito: false }, { nome: 'Zé Henrique', votos: 3215, isEleito: false }, { nome: 'Wilson Cidrao', votos: 2884, isEleito: false }, { nome: 'Sargento Nobre', votos: 2308, isEleito: false }, { nome: 'Thati Teixeira', votos: 2004, isEleito: false }, { nome: 'Cabo Cabral', votos: 1861, isEleito: false }, { nome: 'Sargento Luizinho', votos: 1657, isEleito: false }, { nome: 'Mauro Fiscal', votos: 1402, isEleito: false }, { nome: 'Sub-Tenente Queiroz', votos: 1316, isEleito: false }, { nome: 'Gerson da Farmacia', votos: 1290, isEleito: false }, { nome: 'Fabio Campos', votos: 1156, isEleito: false }, { nome: 'Clair Lima', votos: 1107, isEleito: false }, { nome: 'Rodrigo Konrath', votos: 866, isEleito: false }, { nome: 'Rogério Piloto', votos: 860, isEleito: false }, { nome: 'Sub-Tenente Oliveira', votos: 692, isEleito: false }, { nome: 'Joaquim Chiniski', votos: 582, isEleito: false }, { nome: 'Dr. Christian Alves', votos: 510, isEleito: false }, { nome: 'Fuzileiro Oziel Santos', votos: 428, isEleito: false }, { nome: 'Jorge Vieira', votos: 383, isEleito: false }, { nome: 'Recalcati', votos: 359, isEleito: false }, { nome: 'Joao Silva', votos: 323, isEleito: false }, { nome: 'Leo Gois', votos: 306, isEleito: false }, { nome: 'Sabryna Medeiros', votos: 170, isEleito: false }, { nome: 'Angela Vieira', votos: 164, isEleito: false }, { nome: 'Alessandra Campos', votos: 163, isEleito: false }, { nome: 'Pastor Laudelino das Vans', votos: 156, isEleito: false }, { nome: 'Silvia Mendonça', votos: 151, isEleito: false }, { nome: 'Menegazzo', votos: 132, isEleito: false }, { nome: 'Barbara Costa', votos: 113, isEleito: false }, { nome: 'Marcos Paulista', votos: 111, isEleito: false }, { nome: 'Jean Marenzani', votos: 105, isEleito: false }, { nome: 'Cassy Bueno', votos: 103, isEleito: false }, { nome: 'Marcia Collares', votos: 68, isEleito: false }, { nome: 'Dinara Caroline', votos: 41, isEleito: false }, { nome: 'Marina Sorrentino', votos: 39, isEleito: false }, { nome: 'Pamella Carvalho', votos: 27, isEleito: false } ] }, 
        'PSOL': { votos: 83044, candidatos: [ { nome: 'Marquito', votos: 40329, isEleito: true }, { nome: 'Carolline Sardá', votos: 8221, isEleito: false }, { nome: 'Cíntia Mandata Bem Viver', votos: 7137, isEleito: false }, { nome: 'Livia - Coletiva Raízes', votos: 4205, isEleito: false }, { nome: 'Sargento Amauri Soares', votos: 3527, isEleito: false }, { nome: 'Advogada Rosane', votos: 3387, isEleito: false }, { nome: 'Professor Pedro Cabral', votos: 2727, isEleito: false }, { nome: 'Jéssica Michels', votos: 2613, isEleito: false }, { nome: 'Tânia Ramos', votos: 2207, isEleito: false }, { nome: 'Zelize', votos: 1526, isEleito: false }, { nome: 'Erick Cardoso', votos: 804, isEleito: false }, { nome: 'Alex Stein', votos: 761, isEleito: false }, { nome: 'Thaís Tolentino', votos: 482, isEleito: false }, { nome: 'Matheus Rodrigues', votos: 415, isEleito: false }, { nome: 'Lucas Machado', votos: 385, isEleito: false }, { nome: 'João Porsch - Kiko', votos: 344, isEleito: false }, { nome: 'Andre Fernando Schneider', votos: 273, isEleito: false }, { nome: 'Gilson Carteiro', votos: 216, isEleito: false }, { nome: 'Jaqueline Porto', votos: 145, isEleito: false }, { nome: 'Gabriel Missel', votos: 108, isEleito: false }, { nome: 'Izabel Campos', votos: 90, isEleito: false }, { nome: 'Amarildo Narciso', votos: 72, isEleito: false } ] }, 
        'PDT': { votos: 82141, candidatos: [ { nome: 'Rodrigo Minotto', votos: 28685, isEleito: true }, { nome: 'Prof Daniel Westrupp', votos: 7533, isEleito: false }, { nome: 'André Guesser', votos: 5548, isEleito: false }, { nome: 'Toni Duarte', votos: 4067, isEleito: false }, { nome: 'Jana Guedes', votos: 3984, isEleito: false }, { nome: 'Dorlei', votos: 3109, isEleito: false }, { nome: 'Nandinho Cysne', votos: 2830, isEleito: false }, { nome: 'Profe Mario Sergio Stramosk', votos: 2584, isEleito: false }, { nome: 'Elza Fortes', votos: 2385, isEleito: false }, { nome: 'Ciça Müller', votos: 2271, isEleito: false }, { nome: 'Natel', votos: 1787, isEleito: false }, { nome: 'Cleber Torra Torra', votos: 1715, isEleito: false }, { nome: 'Eduardo Furlanetto', votos: 1309, isEleito: false }, { nome: 'Roberto Bradonski', votos: 777, isEleito: false }, { nome: 'Thaliny', votos: 629, isEleito: false }, { nome: 'Dr Cleberson Garcia', votos: 625, isEleito: false }, { nome: 'Sodré', votos: 597, isEleito: false }, { nome: 'Adilsão', votos: 553, isEleito: false }, { nome: 'Sidiane Aparecida', votos: 508, isEleito: false }, { nome: 'Paulinho', votos: 464, isEleito: false }, { nome: 'Ronaldo Raulino', votos: 457, isEleito: false }, { nome: 'Jussara Inacio', votos: 413, isEleito: false }, { nome: 'Prof Bebeto Bagualito', votos: 324, isEleito: false }, { nome: 'Karinny Simas', votos: 321, isEleito: false }, { nome: 'Rafael Larangeira', votos: 288, isEleito: false }, { nome: 'Marciano da Liga de Lutas', votos: 282, isEleito: false }, { nome: 'Chico Twardovski', votos: 255, isEleito: false }, { nome: 'Renato Pai do Ame Jonatas', votos: 183, isEleito: false }, { nome: 'Sandra Guerreira', votos: 176, isEleito: false }, { nome: 'Nera', votos: 172, isEleito: false }, { nome: 'Apóstola Miriam Feijó', votos: 165, isEleito: false }, { nome: 'Eliana', votos: 153, isEleito: false }, { nome: 'Marcelo de Ogum', votos: 136, isEleito: false }, { nome: 'Rô', votos: 131, isEleito: false }, { nome: 'Vivinho', votos: 70, isEleito: false }, { nome: 'Fernando de Carvalho Ecotv', votos: 54, isEleito: false } ] },
        'DC': { votos: 30781, candidatos: [ { nome: 'Marcos Habitzreuter', votos: 7312, isEleito: false }, { nome: 'Jocimar Santos', votos: 6589, isEleito: false }, { nome: 'Thiago Zaboti', votos: 4886, isEleito: false }, { nome: 'Badotti', votos: 4127, isEleito: false }, { nome: 'Pastor Vanio de Oliveira', votos: 2722, isEleito: false }, { nome: 'Tiago Ronchi', votos: 1662, isEleito: false }, { nome: 'Mario Pereira Acepred', votos: 728, isEleito: false }, { nome: 'Andrea Vieira', votos: 596, isEleito: false }, { nome: 'Fran Kruck', votos: 282, isEleito: false }, { nome: 'Sergio Godinho', votos: 280, isEleito: false }, { nome: 'Emerson Rocha', votos: 272, isEleito: false }, { nome: 'Cabo Benassi', votos: 228, isEleito: false }, { nome: 'Vanderleia', votos: 141, isEleito: false }, { nome: 'José Barreiros', votos: 138, isEleito: false }, { nome: 'José Augusto', votos: 118, isEleito: false }, { nome: 'Fabricio Bianchini', votos: 105, isEleito: false }, { nome: 'Leandro', votos: 99, isEleito: false }, { nome: 'Alberto Silva', votos: 84, isEleito: false }, { nome: 'Adalberto Cassiano', votos: 66, isEleito: false }, { nome: 'Wellington Bahe', votos: 59, isEleito: false }, { nome: 'Jussara Guimaraes', votos: 43, isEleito: false }, { nome: 'Clélia', votos: 40, isEleito: false }, { nome: 'Vilma Lea Rebello', votos: 38, isEleito: false }, { nome: 'Jessica Vicentin', votos: 37, isEleito: false }, { nome: 'Soeli Rosa', votos: 16, isEleito: false }, { nome: 'Poliana', votos: 10, isEleito: false } ] },
        'SD': { votos: 30557, candidatos: [ { nome: 'Osmar Teixeira', votos: 24512, isEleito: false }, { nome: 'Douglas Silveira', votos: 1021, isEleito: false }, { nome: 'Biano Souza', votos: 716, isEleito: false }, { nome: 'Nogueira', votos: 694, isEleito: false }, { nome: 'Professora Angelica', votos: 576, isEleito: false }, { nome: 'Professora Carla', votos: 377, isEleito: false }, { nome: 'Dio Adelino', votos: 296, isEleito: false }, { nome: 'Sonia', votos: 282, isEleito: false }, { nome: 'Wilsimar Rocha', votos: 244, isEleito: false }, { nome: 'Maria Leal Deotti', votos: 239, isEleito: false }, { nome: 'Airtorcorpoealma', votos: 237, isEleito: false }, { nome: 'Jotta', votos: 220, isEleito: false }, { nome: 'Jonas Santos', votos: 213, isEleito: false }, { nome: 'Clayton Bertotto', votos: 170, isEleito: false }, { nome: 'Dr. Geancarlo', votos: 143, isEleito: false }, { nome: 'Tony Vargas', votos: 72, isEleito: false }, { nome: 'José', votos: 57, isEleito: false }, { nome: 'Shirlene Cecatto', votos: 49, isEleito: false }, { nome: 'Monique Walker', votos: 30, isEleito: false } ] },
        'PSC': { votos: 30036, candidatos: [ { nome: 'André Xavier', votos: 6534, isEleito: false }, { nome: 'Felippe Tessmann', votos: 3773, isEleito: false }, { nome: 'Julio Bento', votos: 3263, isEleito: false }, { nome: 'João Luiz da Bega', votos: 2999, isEleito: false }, { nome: 'Edson Bona', votos: 2788, isEleito: false }, { nome: 'Jeferson Dias', votos: 1738, isEleito: false }, { nome: 'Fanuel Refosco', votos: 1180, isEleito: false }, { nome: 'Advogado Claudio Melchioretto', votos: 1138, isEleito: false }, { nome: 'Osvaldo Borges', votos: 665, isEleito: false }, { nome: 'Carlão Metzger', votos: 575, isEleito: false }, { nome: 'Laila Graf', votos: 501, isEleito: false }, { nome: 'Vanderlei Rodrigo', votos: 484, isEleito: false }, { nome: 'Dico Pereira', votos: 405, isEleito: false }, { nome: 'Dr. Ezequias', votos: 367, isEleito: false }, { nome: 'Andre Schueda', votos: 328, isEleito: false }, { nome: 'Noé Hoepers', votos: 277, isEleito: false }, { nome: 'Telmo Demarch', votos: 256, isEleito: false }, { nome: 'Wilson Doin', votos: 255, isEleito: false }, { nome: 'Carla Baumer', votos: 204, isEleito: false }, { nome: 'Gizeli Nicoski', votos: 191, isEleito: false }, { nome: 'Rosemeri Caetano de Oliveira', votos: 177, isEleito: false }, { nome: 'Doutora Simone', votos: 135, isEleito: false }, { nome: 'Andrea Turcato', votos: 133, isEleito: false }, { nome: 'Isolde Kniess', votos: 131, isEleito: false }, { nome: 'Edir Candido', votos: 81, isEleito: false }, { nome: 'Neli Custódio', votos: 71, isEleito: false }, { nome: 'Reginaldo Santos', votos: 58, isEleito: false } ] },
        'CIDA': { votos: 25109, candidatos: [ { nome: 'Tiago Silva', votos: 11135, isEleito: false }, { nome: 'Delegadopj', votos: 3240, isEleito: false }, { nome: 'DRª Janine', votos: 1963, isEleito: false }, { nome: 'Caterine Nogueira', votos: 1945, isEleito: false }, { nome: 'Fabricio Marinho', votos: 1339, isEleito: false }, { nome: 'Pretto', votos: 1147, isEleito: false }, { nome: 'Pastor Antonio', votos: 906, isEleito: false }, { nome: 'Luciane Matteussi', votos: 533, isEleito: false }, { nome: 'Dr. Carlos de Antoni', votos: 165, isEleito: false }, { nome: 'Caique Geller', votos: 157, isEleito: false } ] },
        'PC do B': { votos: 17985, candidatos: [ { nome: 'Valduga', votos: 14665, isEleito: false }, { nome: 'Larissa Stephanie', votos: 2395, isEleito: false } ] },
        'AVAN': { votos: 8610, candidatos: [ { nome: 'Vitor Leopoldo', votos: 1820, isEleito: false }, { nome: 'Edina Esmeraldino', votos: 1587, isEleito: false }, { nome: 'Thalyson de Bairros', votos: 1102, isEleito: false }, { nome: 'Índio Fotógrafo', votos: 1071, isEleito: false }, { nome: 'Marcio Santos', votos: 608, isEleito: false }, { nome: 'Jacó de Freitas', votos: 386, isEleito: false }, { nome: 'Edson Mateus', votos: 291, isEleito: false }, { nome: 'DRª Gisele Lima', votos: 271, isEleito: false }, { nome: 'Oberziner', votos: 236, isEleito: false }, { nome: 'Alazão', votos: 228, isEleito: false }, { nome: 'Professor Juan', votos: 154, isEleito: false }, { nome: 'Vanio Vieira', votos: 126, isEleito: false }, { nome: 'Dai Freitas', votos: 94, isEleito: false }, { nome: 'Ivo da Silva', votos: 85, isEleito: false }, { nome: 'Adriana Haskel', votos: 70, isEleito: false }, { nome: 'Carla Roberta', votos: 65, isEleito: false }, { nome: 'Luizinho do Sacolão', votos: 50, isEleito: false }, { nome: 'Rosi Prudêncio', votos: 15, isEleito: false } ] },
        'PRTB': { votos: 3126, candidatos: [ { nome: 'João Fatini', votos: 760, isEleito: false }, { nome: 'Ari Espíndula', votos: 738, isEleito: false }, { nome: 'Rondnelli Panela Velha', votos: 577, isEleito: false }, { nome: 'Glaudistoni Felix', votos: 445, isEleito: false }, { nome: 'Marcelo Amaral Fontoura', votos: 114, isEleito: false }, { nome: 'Adri Kruger', votos: 86, isEleito: false }, { nome: 'Andreia Machado', votos: 54, isEleito: false }, { nome: 'Roberta Marques', votos: 39, isEleito: false }, { nome: 'Gustavo Machado', votos: 13, isEleito: false } ] },
        'REDE': { votos: 1501, candidatos: [ { nome: 'Sagui Jornaleiro', votos: 318, isEleito: false }, { nome: 'Jair Barbosa', votos: 301, isEleito: false }, { nome: 'Juliano Bueno', votos: 192, isEleito: false }, { nome: 'Joani Moçambique', votos: 111, isEleito: false }, { nome: 'Eliane Greggio', votos: 78, isEleito: false }, { nome: 'Grazi Silva', votos: 35, isEleito: false }, { nome: 'Geva Ferro', votos: 15, isEleito: false } ] },
        'PSTU': { votos: 1083, candidatos: [ { nome: 'Carlos Coletivo Educação', votos: 381, isEleito: false } ] },
        'PROS': { votos: 1010, candidatos: [ { nome: 'Vagner Visoli', votos: 385, isEleito: false }, { nome: 'Felipe Yago', votos: 329, isEleito: false }, { nome: 'Caio Vieira', votos: 66, isEleito: false } ] },
        'PV': { votos: 590, candidatos: [ { nome: 'Márcia Hasse', votos: 86, isEleito: false }, { nome: 'Frank Lôbo', votos: 63, isEleito: false } ] },
        'PCO': { votos: 0, candidatos: [ { nome: 'Arthur Cesconetto Souza', votos: 155, isEleito: false } ] }
    } } ] } } };
    const PARTY_COLORS = { 'PL': '#0ea5e9', 'MDB': '#facc15', 'PT': '#dc2626', 'PODE': '#38bdf8', 'PP': '#0284c7', 'PSD': '#f97316', 'UNIÃO': '#1e3a8a', 'PSDB': '#0c4a6e', 'REPU': '#2563eb', 'NOVO': '#ea580c', 'PTB': '#4b5563', 'PSB': '#ef4444', 'PATRI': '#059669', 'PSOL': '#f59e0b', 'PDT': '#0d9488', 'DC': '#166534', 'SD': '#f97316', 'PSC': '#2563eb', 'CIDA': '#65a30d', 'PC do B': '#ef4444', 'AVAN': '#0ea5e9', 'PRTB': '#0891b2', 'REDE': '#22c55e', 'PSTU': '#dc2626', 'PROS': '#f97316', 'PV': '#22c55e', 'PCO': '#7f1d1d' };
    
    let baseScenario = {};
    let currentSimulatedScenario = {};

    // =================================================================================
    // LÓGICA PRINCIPAL
    // =================================================================================
    document.addEventListener('DOMContentLoaded', () => {
        baseScenario = prepareBaseScenario();
        initializeControls();
        initializeCandidatosTab();
        initializeLogoEditor();
        updateScenario();
    });

    function prepareBaseScenario() {
        const historico2022 = DADOS_ELEICOES.SC.de.historico.find(h => h.ano === 2022);
        const comparecimentoBase2022 = historico2022.votos_validos + historico2022.votos_brancos + historico2022.votos_nulos;

        const partidos = Object.keys(historico2022.partidos).map(nome => {
            const p2022 = historico2022.partidos[nome];
            return {
                nome,
                votosBase2022: p2022.votos,
                candidatos: p2022.candidatos.sort((a,b) => b.votos - a.votos),
                customCandidatos: null, // Para legendas personalizadas
                boost: 0
            };
        });

        return {
            eleitoradoBase2022: historico2022.eleitorado,
            votosValidosBase2022: historico2022.votos_validos,
            votosBrancosBase2022: historico2022.votos_brancos,
            votosNulosBase2022: historico2022.votos_nulos,
            percentualValidosBase: historico2022.votos_validos / comparecimentoBase2022,
            percentualBrancosBase: historico2022.votos_brancos / comparecimentoBase2022,
            percentualNulosBase: historico2022.votos_nulos / comparecimentoBase2022,
            partidos
        };
    }
    
    function initializeControls() {
        const boostContainer = document.getElementById('party-boost-container');
        const allianceContainer = document.getElementById('alliance-party-container');
        
        // Popula os dados base de 2022
        document.getElementById('base-abstention-display').textContent = (DADOS_ELEICOES.SC.de.historico[0].abstencao * 100).toFixed(1);
        document.getElementById('base-electorate-display').textContent = DADOS_ELEICOES.SC.de.historico[0].eleitorado.toLocaleString('pt-BR');

        baseScenario.partidos.sort((a,b) => b.votosBase2022 - a.votosBase2022).forEach(p => {
            const color = PARTY_COLORS[p.nome] || '#64748b';
            
            // Boost controls
            const boostItem = document.createElement('div');
            boostItem.innerHTML = `
                <label for="boost-${p.nome}" class="flex items-center text-sm font-medium text-text-light mb-1">
                    <div class="w-3 h-3 rounded-full mr-2" style="background-color: ${color}"></div>
                    ${p.nome}
                </label>
                <div class="flex items-center space-x-2">
                    <input type="range" id="boost-${p.nome}" min="-20" max="20" value="0" step="1" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer" oninput="updateScenario()">
                    <span id="boost-value-${p.nome}" class="font-mono text-xs w-12 text-right">0%</span>
                </div>
            `;
            boostContainer.appendChild(boostItem);

            // Alliance controls
            const allianceItem = document.createElement('div');
            allianceItem.innerHTML = `
                <input type="checkbox" id="alliance-${p.nome}" value="${p.nome}" class="hidden alliance-checkbox" onchange="updateAllianceButton()">
                <label for="alliance-${p.nome}" class="cursor-pointer border border-border px-2 py-1 rounded-md text-xs font-semibold text-text-light transition-all duration-200">${p.nome}</label>
            `;
            allianceContainer.appendChild(allianceItem);
        });
    }

    function updateScenario() {
        const abstentionRate = parseFloat(document.getElementById('abstention-rate').value) / 100;
        const electorateGrowth = parseFloat(document.getElementById('electorate-growth').value) / 100;
        document.getElementById('abstention-value').textContent = (abstentionRate * 100).toFixed(1);
        document.getElementById('electorate-growth-value').textContent = (electorateGrowth * 100).toFixed(1);

        baseScenario.partidos.forEach(p => {
            const boostInput = document.getElementById(`boost-${p.nome}`);
            if (boostInput && !boostInput.disabled) {
                p.boost = parseFloat(boostInput.value) / 100;
                const boostValueEl = document.getElementById(`boost-value-${p.nome}`);
                if(boostValueEl) boostValueEl.textContent = `${(p.boost * 100).toFixed(0)}%`;
            }
        });
        
        currentSimulatedScenario = calculateSimulatedScenario(abstentionRate, electorateGrowth);
        renderAll(currentSimulatedScenario);
    }

    function calculateSimulatedScenario(abstentionRate, electorateGrowth, allianceParties = []) {
        const eleitoradoProjetado = Math.floor(baseScenario.eleitoradoBase2022 * (1 + electorateGrowth));
        const comparecimentoProjetado = Math.floor(eleitoradoProjetado * (1 - abstentionRate));
        
        const votosValidosProjetado = Math.floor(comparecimentoProjetado * baseScenario.percentualValidosBase);
        const votosBrancosProjetado = Math.floor(comparecimentoProjetado * baseScenario.percentualBrancosBase);
        const votosNulosProjetado = Math.floor(comparecimentoProjetado * baseScenario.percentualNulosBase);

        const QE = Math.floor(votosValidosProjetado / DADOS_ELEICOES.SC.de.vagas);

        let partidosSimulados = baseScenario.partidos.map(p => {
            let votosFinais;
            let notaCorte;
            let eleitos;
            let votosProjetadosBase;

            if (p.customCandidatos) {
                votosProjetadosBase = p.customCandidatos.reduce((sum, cand) => sum + cand.votos, 0);
                votosFinais = votosProjetadosBase; // Boost is disabled for custom lists
                eleitos = p.customCandidatos.slice();
                const ultimoEleito = eleitos.length > 0 ? eleitos[Math.min(eleitos.length, 40) - 1] : null;
                notaCorte = ultimoEleito ? ultimoEleito.votos : 0;
            } else {
                votosProjetadosBase = p.votosBase2022;
                votosFinais = Math.floor(votosProjetadosBase * (1 + p.boost));
                eleitos = p.candidatos.filter(c => c.isEleito);
                const ultimoEleitoBase = eleitos[eleitos.length - 1];
                notaCorte = ultimoEleitoBase ? Math.floor(ultimoEleitoBase.votos * (1 + p.boost)) : 0;
            }
            
            const notaCorteFinal = Math.max(notaCorte, (QE > 0 ? Math.ceil(QE * 0.10) : 0));

            return { ...p, votos: votosFinais, notaCorte: notaCorteFinal, eleitos2022: eleitos, votosProjetadosBase };
        });

        if (allianceParties.length > 1) {
            const allianceData = { nome: `ALIANÇA (${allianceParties.join('+')})`, votos: 0, notaCorte: 0, boost: 0, eleitos2022: [], votosProjetadosBase: 0 };
            const remainingParties = [];
            
            partidosSimulados.forEach(p => {
                if (allianceParties.includes(p.nome)) {
                    allianceData.votos += p.votos;
                    allianceData.votosProjetadosBase += p.votosProjetadosBase;
                    allianceData.notaCorte = Math.max(allianceData.notaCorte, p.notaCorte);
                    allianceData.eleitos2022.push(...p.eleitos2022);
                } else {
                    remainingParties.push(p);
                }
            });
            allianceData.eleitos2022.sort((a,b) => b.votos - a.votos);
            partidosSimulados = [allianceData, ...remainingParties];
        }

        const distributionResult = distributeVagas(partidosSimulados, QE, votosValidosProjetado, eleitoradoProjetado);
        
        return { 
            ...distributionResult,
            QE, 
            totalVotosValidos: votosValidosProjetado,
            totalVotosBrancos: votosBrancosProjetado,
            totalVotosNulos: votosNulosProjetado,
            totalEleitores: eleitoradoProjetado,
            comparecimentoProjetado: comparecimentoProjetado
        };
    }

    function distributeVagas(partidos, QE, totalVotos, totalEleitores) {
        let cenarios = JSON.parse(JSON.stringify(partidos));
        let totalVagasDiretas = 0;

        cenarios.forEach(p => {
            p.vagasDiretas = (QE > 0) ? Math.floor(p.votos / QE) : 0;
            p.vagasSobras = 0;
            totalVagasDiretas += p.vagasDiretas;
        });

        let vagasSobrasRestantes = DADOS_ELEICOES.SC.de.vagas - totalVagasDiretas;
        let partidosAptos = cenarios.filter(p => p.votos >= (QE * 0.80));
        let sobrasLog = [];

        while (vagasSobrasRestantes > 0 && partidosAptos.length > 0) {
            partidosAptos.forEach(p => {
                p.mediaVotos = p.votos / (p.vagasDiretas + p.vagasSobras + 1);
            });
            partidosAptos.sort((a, b) => b.mediaVotos - a.mediaVotos);
            
            const vencedor = partidosAptos[0];
            if (vencedor) {
                vencedor.vagasSobras++;
                const perdedor = partidosAptos[1];
                sobrasLog.push({
                    vaga: DADOS_ELEICOES.SC.de.vagas - vagasSobrasRestantes + 1,
                    vencedor: vencedor.nome,
                    mediaVencedor: vencedor.mediaVotos,
                    perdedor: perdedor ? perdedor.nome : null,
                    mediaPerdedor: perdedor ? perdedor.mediaVotos : 0,
                });
                vagasSobrasRestantes--;
            } else {
                break;
            }
        }

        cenarios.forEach(p => { p.totalVagas = p.vagasDiretas + p.vagasSobras; });
        
        return { cenarios, sobrasLog };
    }
    
    // =================================================================================
    // FUNÇÕES DE RENDERIZAÇÃO
    // =================================================================================
    function renderAll(simulatedScenario) {
        const { QE, totalVotosValidos, totalVotosBrancos, totalVotosNulos, cenarios, sobrasLog } = simulatedScenario;

        // --- Update summary panel ---
        document.getElementById('summary-vv').textContent = totalVotosValidos.toLocaleString('pt-BR');
        document.getElementById('summary-vb').textContent = totalVotosBrancos.toLocaleString('pt-BR');
        document.getElementById('summary-vn').textContent = totalVotosNulos.toLocaleString('pt-BR');
        document.getElementById('summary-qe').textContent = QE.toLocaleString('pt-BR');
        const partidosComVaga = cenarios.filter(p => p.totalVagas > 0);
        const notaCorteMedia = partidosComVaga.length > 0 ? Math.ceil(partidosComVaga.reduce((acc, p) => acc + p.notaCorte, 0) / partidosComVaga.length) : 0;
        document.getElementById('summary-nc').textContent = (notaCorteMedia || 0).toLocaleString('pt-BR');
        document.getElementById('summary-vr').textContent = sobrasLog.length.toLocaleString('pt-BR');

        renderVagasDist(cenarios);
        renderRisk(sobrasLog.slice().reverse());
    }

    function renderVagasDist(cenarios) {
        const container = document.getElementById('vagas-dist-container');
        container.innerHTML = '';
        const sorted = [...cenarios].filter(p => p.totalVagas > 0).sort((a, b) => b.totalVagas - a.totalVagas);

        sorted.forEach(p => {
            const color = PARTY_COLORS[p.nome] || '#64748b';
            const item = document.createElement('div');
            item.className = 'p-2 rounded-lg clickable';
            item.setAttribute('onclick', `showPartyModal('${p.nome}')`);
            const customIcon = p.customCandidatos ? '<i class="fa-solid fa-user-pen text-secondary text-xs ml-2"></i>' : '';
            item.innerHTML = `
                <div class="flex justify-between items-center mb-1">
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full mr-2" style="background-color: ${color}"></div>
                        <span class="font-bold">${p.nome}</span>
                        ${customIcon}
                    </div>
                    <span class="font-bold text-lg">${p.totalVagas} <span class="text-sm font-normal text-text-light">vaga(s)</span></span>
                </div>
                <div class="w-full bg-slate-700 rounded-full h-4 overflow-hidden">
                    <div class="bg-primary h-4 rounded-full party-bar" style="width: ${p.totalVagas > 0 ? (p.vagasDiretas / p.totalVagas * 100) : 0}%" title="Vagas Diretas: ${p.vagasDiretas}"></div>
                </div>
                <div class="text-xs text-text-light mt-1 flex justify-between">
                    <span>${p.vagasDiretas} direta(s) / ${p.vagasSobras} sobra(s)</span>
                    <span>NC: <span class="font-bold text-warning">${p.notaCorte.toLocaleString('pt-BR')}</span></span>
                </div>
            `;
            container.appendChild(item);
        });
    }

    function renderRisk(riskLog) {
        const container = document.getElementById('risk-container');
        container.innerHTML = '';
        if(riskLog.length === 0) {
            container.innerHTML = `<p class="text-center text-text-light p-4">Nenhuma vaga de sobra disputada neste cenário.</p>`;
            return;
        }

        riskLog.forEach((log, index) => {
            const diff = log.perdedor ? Math.ceil(log.mediaVencedor - log.mediaPerdedor) : 0;
            const item = document.createElement('div');
            item.className = 'bg-slate-900/50 p-3 rounded-lg risk-card gain clickable';
            item.setAttribute('onclick', `showRiskModal(${index})`);
            item.innerHTML = `
                <div class="flex justify-between items-center">
                    <div class="font-bold text-sm">VAGA #${log.vaga}</div>
                    <div class="text-xs font-mono bg-danger/20 text-danger px-2 py-0.5 rounded-full">ALTO RISCO</div>
                </div>
                <div class="mt-2 space-y-2">
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-success"><i class="fa-solid fa-circle-check mr-2"></i>GANHANDO: <strong>${log.vencedor}</strong></span>
                        <span class="font-mono text-text-main">${Math.ceil(log.mediaVencedor).toLocaleString('pt-BR')}</span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-text-light"><i class="fa-solid fa-circle-radiation mr-2"></i>AMEAÇANDO: <strong>${log.perdedor || 'N/A'}</strong></span>
                         <span class="font-mono text-text-main">${log.perdedor ? Math.ceil(log.mediaPerdedor).toLocaleString('pt-BR') : '-'}</span>
                    </div>
                </div>
                <div class="mt-2 pt-2 border-t border-border/50 text-center text-xs text-secondary">
                    Diferença de Média: <strong>${diff.toLocaleString('pt-BR')} votos</strong>
                </div>
            `;
            container.appendChild(item);
        });
    }
    
    // =================================================================================
    // LÓGICA DOS MODAIS
    // =================================================================================
    function showModal(content) {
        const modal = document.getElementById('modal');
        const modalContent = document.getElementById('modal-content');
        const modalOverlay = document.getElementById('modal-overlay');
        
        modalContent.innerHTML = content;
        modal.classList.remove('hidden');
        
        setTimeout(() => {
            modalOverlay.classList.remove('opacity-0');
            modalOverlay.classList.add('opacity-100');
            modalContent.classList.remove('opacity-0', 'scale-95');
            modalContent.classList.add('opacity-100', 'scale-100');
        }, 10);
    }

    function closeModal() {
        const modal = document.getElementById('modal');
        const modalContent = document.getElementById('modal-content');
        const modalOverlay = document.getElementById('modal-overlay');

        modalOverlay.classList.remove('opacity-100');
        modalOverlay.classList.add('opacity-0');
        modalContent.classList.remove('opacity-100', 'scale-100');
        modalContent.classList.add('opacity-0', 'scale-95');

        setTimeout(() => {
            modal.classList.add('hidden');
            modalContent.innerHTML = '';
        }, 300);
    }
    
    function showPartyModal(partyName) {
        const partyData = currentSimulatedScenario.cenarios.find(p => p.nome === partyName);
        if (!partyData) return;

        const color = PARTY_COLORS[partyName] || '#64748b';
        
        const diretas = Array.from({ length: partyData.vagasDiretas }, (_, i) => i);
        const sobras = Array.from({ length: partyData.vagasSobras }, (_, i) => i + partyData.vagasDiretas);

        const generateCandidateHtml = (index) => {
            const candidato = partyData.eleitos2022[index];
            if (!candidato) {
                return `
                    <li class="bg-background p-2 rounded-md opacity-70">
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-sm">${index + 1}. Nova Liderança</span>
                            <span class="font-bold text-lg text-warning">${partyData.notaCorte.toLocaleString('pt-BR')}</span>
                        </div>
                        <div class="text-xs text-text-light flex justify-between items-center mt-1">
                            <span>Votos Base: N/A</span>
                            <span>Meta Mínima</span>
                        </div>
                    </li>
                `;
            }
            const votosProjetados = partyData.customCandidatos ? candidato.votos : Math.floor(candidato.votos * (1 + partyData.boost));
            const diff = votosProjetados - partyData.notaCorte;
            return `
                <li class="bg-background p-2 rounded-md">
                    <div class="flex justify-between items-center">
                        <span class="font-bold text-sm">${index + 1}. ${candidato.nome}</span>
                        <span class="font-bold text-lg text-primary">${votosProjetados.toLocaleString('pt-BR')}</span>
                    </div>
                    <div class="text-xs text-text-light flex justify-between items-center mt-1">
                        <span>Votos Base: ${candidato.votos.toLocaleString('pt-BR')}</span>
                        <span class="${diff >= 0 ? 'text-success' : 'text-danger'}">
                            ${diff >= 0 ? '+' : ''}${diff.toLocaleString('pt-BR')} vs. NC
                        </span>
                    </div>
                </li>
            `;
        };

        const diretasHtml = diretas.length > 0 ? diretas.map(generateCandidateHtml).join('') : '<li class="text-sm text-text-light text-center p-2">Nenhuma cadeira direta conquistada.</li>';
        const sobrasHtml = sobras.length > 0 ? sobras.map(generateCandidateHtml).join('') : '<li class="text-sm text-text-light text-center p-2">Nenhuma cadeira de sobra conquistada.</li>';
        
        const ultimoEleitoBase = partyData.eleitos2022 && partyData.eleitos2022.length > 0 ? partyData.eleitos2022[partyData.eleitos2022.length - 1] : null;
        const ultimoEleitoVotosStr = ultimoEleitoBase ? ultimoEleitoBase.votos.toLocaleString('pt-BR') : 'N/A';

        const modalHtml = `
            <div class="p-6 text-text-light">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full mr-3" style="background-color: ${color}"></div>
                        <div>
                            <h2 class="text-2xl font-bold text-text-main">${partyName}</h2>
                            <p>Dossiê do Partido no Cenário Atual</p>
                        </div>
                    </div>
                    <button onclick="closeModal()" class="text-text-light hover:text-text-main text-2xl">&times;</button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-background p-4 rounded-lg">
                        <h3 class="font-bold mb-2 text-text-main">Composição dos Votos</h3>
                        <ul class="text-sm space-y-2 font-mono">
                            <li class="flex justify-between"><span>Base de Votos (2022):</span> <span>${(partyData.votosProjetadosBase).toLocaleString('pt-BR')}</span></li>
                            <li class="flex justify-between"><span>Impulso (${(partyData.boost * 100).toFixed(0)}%):</span> <span class="${partyData.boost > 0 ? 'text-success' : partyData.boost < 0 ? 'text-danger' : ''}">${(partyData.votos - partyData.votosProjetadosBase).toLocaleString('pt-BR')}</span></li>
                            <li class="flex justify-between border-t border-border pt-2 mt-2"><strong>TOTAL PROJETADO:</strong> <strong>${partyData.votos.toLocaleString('pt-BR')}</strong></li>
                        </ul>
                    </div>
                     <div class="bg-background p-4 rounded-lg">
                        <h3 class="font-bold mb-2 text-text-main">Cálculo da Nota de Corte</h3>
                        <ul class="text-sm space-y-2 font-mono">
                            <li class="flex justify-between"><span>Último Eleito (Base):</span> <span>${ultimoEleitoVotosStr}</span></li>
                            <li class="flex justify-between"><span>Impulso de Campanha:</span> <span>${(partyData.boost * 100).toFixed(0)}%</span></li>
                            <li class="flex justify-between border-t border-border pt-2 mt-2"><strong>META PROJETADA:</strong> <strong class="text-warning">${partyData.notaCorte.toLocaleString('pt-BR')}</strong></li>
                        </ul>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-background p-4 rounded-lg">
                        <h3 class="font-bold mb-2 text-text-main"><i class="fa-solid fa-bolt text-primary mr-1"></i>Cadeiras Diretas (${diretas.length})</h3>
                        <ul class="text-sm space-y-2">${diretasHtml}</ul>
                    </div>
                    <div class="bg-background p-4 rounded-lg">
                        <h3 class="font-bold mb-2 text-text-main"><i class="fa-solid fa-shuffle text-warning mr-1"></i>Cadeiras de Sobra (${sobras.length})</h3>
                        <ul class="text-sm space-y-2">${sobrasHtml}</ul>
                    </div>
                </div>
            </div>
        `;
        showModal(modalHtml);
    }

    function showRiskModal(logIndex) {
        const log = currentSimulatedScenario.sobrasLog.slice().reverse()[logIndex];
        if (!log) return;

        const { vencedor, perdedor, mediaVencedor, mediaPerdedor, vaga } = log;
        const diff = perdedor ? Math.ceil(mediaVencedor - mediaPerdedor) : 0;
        
        const vencedorData = currentSimulatedScenario.cenarios.find(p => p.nome === vencedor);
        const perdedorData = currentSimulatedScenario.cenarios.find(p => p.nome === perdedor);

        let analise = '';
        if (perdedorData) {
            const votosNecessarios = Math.ceil((mediaVencedor - perdedorData.mediaVotos) * (perdedorData.totalVagas + 1));
            const boostNecessario = (perdedorData.votos > 0) ? (votosNecessarios / perdedorData.votos) * 100 : 0;
            analise = `
                <h3 class="font-bold mt-4 mb-2 text-secondary">Análise de Virada</h3>
                <p class="text-sm">Para o <strong>${perdedor}</strong> tomar esta vaga, precisaria de um adicional de <strong>${votosNecessarios.toLocaleString('pt-BR')}</strong> votos, o que equivale a um "Impulso de Campanha" de aproximadamente <strong>+${boostNecessario.toFixed(1)}%</strong>.</p>
            `;
        }

        const modalHtml = `
             <div class="p-6 text-text-light">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-danger">Análise Tática: Vaga #${vaga}</h2>
                        <p>Disputa por uma cadeira de sobra.</p>
                    </div>
                    <button onclick="closeModal()" class="text-text-light hover:text-text-main text-2xl">&times;</button>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-success/10 p-4 rounded-lg border border-success/30">
                        <p class="text-sm font-bold text-success">CONQUISTANDO A VAGA</p>
                        <p class="text-xl font-bold">${vencedor}</p>
                        <p class="font-mono text-lg">${Math.ceil(mediaVencedor).toLocaleString('pt-BR')} <span class="text-xs text-text-light"> Média de Votos</span></p>
                    </div>
                    <div class="bg-warning/10 p-4 rounded-lg border border-warning/30">
                        <p class="text-sm font-bold text-warning">AMEAÇA IMEDIATA</p>
                        <p class="text-xl font-bold">${perdedor || 'N/A'}</p>
                        <p class="font-mono text-lg">${perdedor ? Math.ceil(mediaPerdedor).toLocaleString('pt-BR') : '-'} <span class="text-xs text-text-light"> Média de Votos</span></p>
                    </div>
                </div>

                <div class="mt-4 text-center bg-background p-3 rounded-lg">
                    <p class="text-sm text-text-light">Diferença de Média para Virada</p>
                    <p class="text-2xl font-bold text-secondary">${diff.toLocaleString('pt-BR')} Votos</p>
                </div>
                
                <div class="bg-background p-4 rounded-lg mt-4">
                    ${analise}
                </div>
             </div>
        `;
        showModal(modalHtml);
    }
    
    // =================================================================================
    // LÓGICA DO SIMULADOR DE ALIANÇAS
    // =================================================================================
    function updateAllianceButton() {
        const selected = document.querySelectorAll('.alliance-checkbox:checked').length;
        document.getElementById('alliance-button').disabled = selected < 2;
    }

    function simularAlianca() {
        const selectedParties = Array.from(document.querySelectorAll('.alliance-checkbox:checked')).map(el => el.value);
        if (selectedParties.length < 2) return;

        const abstentionRate = parseFloat(document.getElementById('abstention-rate').value) / 100;
        const electorateGrowth = parseFloat(document.getElementById('electorate-growth').value) / 100;
        
        const allianceScenario = calculateSimulatedScenario(abstentionRate, electorateGrowth, selectedParties);
        const baselineScenario = currentSimulatedScenario;

        const allianceResult = allianceScenario.cenarios.find(p => p.nome.startsWith('ALIANÇA'));
        const vagasAlianca = allianceResult ? allianceResult.totalVagas : 0;

        let vagasSeparados = 0;
        selectedParties.forEach(partyName => {
            const baselineParty = baselineScenario.cenarios.find(p => p.nome === partyName);
            if (baselineParty) {
                vagasSeparados += baselineParty.totalVagas;
            }
        });

        const ganhoLiquido = vagasAlianca - vagasSeparados;
        let impactoHtml = '';
        baselineScenario.cenarios.forEach(baselineParty => {
            if (selectedParties.includes(baselineParty.nome)) return;
            const allianceParty = allianceScenario.cenarios.find(p => p.nome === baselineParty.nome);
            const diff = (allianceParty ? allianceParty.totalVagas : 0) - baselineParty.totalVagas;
            if (diff !== 0) {
                const color = diff > 0 ? 'text-success' : 'text-danger';
                const icon = diff > 0 ? 'fa-arrow-up' : 'fa-arrow-down';
                impactoHtml += `<li class="flex justify-between"><span>${baselineParty.nome}</span> <span class="font-bold ${color}">${diff > 0 ? '+' : ''}${diff} vaga(s) <i class="fa-solid ${icon}"></i></span></li>`;
            }
        });

        const modalHtml = `
            <div class="p-6">
                 <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-secondary">Análise de Aliança</h2>
                        <p class="text-text-light">${selectedParties.join(' + ')}</p>
                    </div>
                    <button onclick="closeModal()" class="text-text-light hover:text-text-main text-2xl">&times;</button>
                </div>
                <div class="grid grid-cols-2 gap-4 text-center">
                    <div class="bg-background p-4 rounded-lg">
                        <p class="text-sm text-text-light">Vagas (Separados)</p>
                        <p class="text-4xl font-bold">${vagasSeparados}</p>
                    </div>
                    <div class="bg-primary/20 p-4 rounded-lg">
                        <p class="text-sm text-primary">Vagas (Aliança)</p>
                        <p class="text-4xl font-bold text-primary">${vagasAlianca}</p>
                    </div>
                </div>
                <div class="mt-4 text-center bg-background p-3 rounded-lg">
                    <p class="text-sm text-text-light">Ganho Líquido</p>
                    <p class="text-2xl font-bold ${ganhoLiquido > 0 ? 'text-success' : ganhoLiquido < 0 ? 'text-danger' : ''}">${ganhoLiquido > 0 ? '+' : ''}${ganhoLiquido} Vaga(s)</p>
                </div>
                <div class="mt-4 bg-background p-4 rounded-lg">
                    <h3 class="font-bold mb-2">Impacto no Cenário</h3>
                    <ul class="text-sm space-y-2">${impactoHtml || '<li class="text-text-light">Nenhum outro partido foi impactado.</li>'}</ul>
                </div>
            </div>
        `;
        showModal(modalHtml);
    }
    
    // =================================================================================
    // LÓGICA DO EDITOR DE LEGENDAS
    // =================================================================================
    
    function openLegendaEditor() {
        let optionsHtml = baseScenario.partidos.map(p => `<option value="${p.nome}">${p.nome}</option>`).join('');
        const modalHtml = `
            <div class="p-6 text-text-light">
                 <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-secondary">Editor de Legendas</h2>
                        <p>Selecione um partido para editar sua lista de candidatos.</p>
                    </div>
                    <button onclick="closeModal()" class="text-text-light hover:text-text-main text-2xl">&times;</button>
                </div>
                <div class="flex items-end gap-4">
                    <div class="flex-grow">
                        <label for="legenda-party-select" class="text-sm font-medium">Partido</label>
                        <select id="legenda-party-select" class="w-full bg-slate-700 p-2 rounded-lg border border-border mt-1">
                            <option value="">Selecione...</option>
                            ${optionsHtml}
                        </select>
                    </div>
                    <button class="bg-primary px-4 py-2 rounded-lg" onclick="loadPartyEditor()">Carregar</button>
                </div>
                <div id="legenda-editor-content" class="mt-4"></div>
            </div>
        `;
        showModal(modalHtml);
    }

    function loadPartyEditor() {
        const partyName = document.getElementById('legenda-party-select').value;
        if (!partyName) return;

        const partyData = baseScenario.partidos.find(p => p.nome === partyName);
        const candidates = partyData.customCandidatos || partyData.candidatos;
        
        let candidatesHtml = candidates.map((cand, index) => `
            <div class="flex items-center gap-2" data-candidate-index="${index}">
                <input type="text" placeholder="Nome do Candidato" value="${cand.nome}" class="w-full bg-slate-900 p-2 rounded-lg border border-border">
                <input type="number" placeholder="Votos" value="${cand.votos}" class="w-1/2 bg-slate-900 p-2 rounded-lg border border-border">
                <button class="bg-danger text-white px-3 py-2 rounded-lg" onclick="removeCandidateRow(this)">&times;</button>
                <button class="bg-secondary text-white px-3 py-2 rounded-lg" title="Migrar Candidato" onclick="migrateCandidate(this, '${partyName}', ${index})"><i class="fa-solid fa-right-left"></i></button>
            </div>
        `).join('');

        const editorContent = `
            <div id="candidate-list" class="space-y-2 max-h-64 overflow-y-auto pr-2">${candidatesHtml}</div>
            <button class="mt-2 text-sm text-primary" onclick="addCandidateRow()"><i class="fa-solid fa-plus mr-2"></i>Adicionar Candidato</button>
            <div class="mt-4 flex justify-between">
                <button class="text-sm text-danger" onclick="resetLegenda('${partyName}')">Restaurar Padrão (2022)</button>
                <div>
                    <button class="bg-success text-white font-bold py-2 px-4 rounded-lg" onclick="saveLegenda('${partyName}')">Salvar e Simular</button>
                </div>
            </div>
        `;
        document.getElementById('legenda-editor-content').innerHTML = editorContent;
    }

    function addCandidateRow() {
        const list = document.getElementById('candidate-list');
        const newRow = document.createElement('div');
        newRow.className = 'flex items-center gap-2';
        newRow.innerHTML = `
            <input type="text" placeholder="Nome do Candidato" class="w-full bg-slate-900 p-2 rounded-lg border border-border">
            <input type="number" placeholder="Votos" class="w-1/2 bg-slate-900 p-2 rounded-lg border border-border">
            <button class="bg-danger text-white px-3 py-2 rounded-lg" onclick="removeCandidateRow(this)">&times;</button>
            <div class="w-10"></div>
        `;
        list.appendChild(newRow);
    }

    function removeCandidateRow(button) {
        button.parentElement.remove();
    }

    function saveLegenda(partyName) {
        const partyData = baseScenario.partidos.find(p => p.nome === partyName);
        const rows = document.querySelectorAll('#candidate-list > div');
        const newCandidatos = [];
        let totalVotes = 0;
        rows.forEach(row => {
            const nameInput = row.children[0];
            const votesInput = row.children[1];
            const name = nameInput.value.trim();
            const votes = parseInt(votesInput.value, 10) || 0;
            if (name && votes > 0) {
                newCandidatos.push({ nome: name, votos: votes });
                totalVotes += votes;
            }
        });

        newCandidatos.sort((a,b) => b.votos - a.votos);
        partyData.customCandidatos = newCandidatos;
        partyData.votosBase2022 = totalVotes; // Override base votes with the sum of custom candidates
        
        // Disable boost for this party as it's now manually controlled
        const boostInput = document.getElementById(`boost-${partyName}`);
        if(boostInput) {
            boostInput.value = 0;
            boostInput.disabled = true;
        }

        closeModal();
        updateScenario();
    }

    function resetLegenda(partyName) {
        const partyData = baseScenario.partidos.find(p => p.nome === partyName);
        partyData.customCandidatos = null;
        partyData.votosBase2022 = DADOS_ELEICOES.SC.de.historico[0].partidos[partyName].votos; // Restore original base votes
        
        const boostInput = document.getElementById(`boost-${partyName}`);
        if(boostInput) {
            boostInput.disabled = false;
        }
        
        loadPartyEditor(); // Reload editor to show default
    }
    
    function migrateCandidate(button, fromPartyName, candidateIndex) {
        const toPartyName = prompt("Digite a sigla do partido de destino:");
        if (!toPartyName || toPartyName.trim() === '' || toPartyName.toUpperCase() === fromPartyName) return;

        const toParty = baseScenario.partidos.find(p => p.nome.toUpperCase() === toPartyName.toUpperCase());
        if (!toParty) {
            alert("Partido de destino não encontrado.");
            return;
        }

        const fromParty = baseScenario.partidos.find(p => p.nome === fromPartyName);
        
        // Garante que ambos os partidos usem listas customizadas a partir de agora
        if (!fromParty.customCandidatos) fromParty.customCandidatos = JSON.parse(JSON.stringify(fromParty.candidatos));
        if (!toParty.customCandidatos) toParty.customCandidatos = JSON.parse(JSON.stringify(toParty.candidatos));

        const candidate = fromParty.customCandidatos.splice(candidateIndex, 1)[0];
        toParty.customCandidatos.push(candidate);
        toParty.customCandidatos.sort((a, b) => b.votos - a.votos);

        // Recalcula os votos base de ambos os partidos
        fromParty.votosBase2022 = fromParty.customCandidatos.reduce((sum, cand) => sum + cand.votos, 0);
        toParty.votosBase2022 = toParty.customCandidatos.reduce((sum, cand) => sum + cand.votos, 0);
        
        // Desabilita o boost para ambos
        const boostInputFrom = document.getElementById(`boost-${fromParty.nome}`);
        if(boostInputFrom) boostInputFrom.disabled = true;
        const boostInputTo = document.getElementById(`boost-${toParty.nome}`);
        if(boostInputTo) boostInputTo.disabled = true;

        loadPartyEditor(); // Recarrega o editor do partido de origem
    }

    // =================================================================================
    // LÓGICA DA ABA DE CANDIDATOS
    // =================================================================================
    function initializeCandidatosTab() {
        const container = document.getElementById('candidatos-accordion-container');
        container.innerHTML = '';

        baseScenario.partidos.sort((a, b) => a.nome.localeCompare(b.nome)).forEach(party => {
            const color = PARTY_COLORS[party.nome] || '#64748b';

            const accordionItem = document.createElement('div');
            accordionItem.className = 'bg-slate-900/50 rounded-lg party-accordion-item';
            
            const totalVotosPartido = party.votosBase2022;
            const totalCandidatos = party.candidatos.length;

            let candidatesHtml = party.candidatos.map(cand => `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-3 border-t border-border candidate-row" data-name="${cand.nome.toLowerCase()}">
                    <div class="font-bold text-text-main">${cand.nome} ${cand.isEleito ? '<i class="fa-solid fa-check-circle text-success text-xs"></i>' : ''}</div>
                    <div class="text-text-light md:text-right"><strong class="text-main">${cand.votos.toLocaleString('pt-BR')}</strong> Votos Totais</div>
                </div>
            `).join('');

            accordionItem.innerHTML = `
                <button class="w-full p-4 text-left font-bold flex justify-between items-center text-text-main" onclick="this.nextElementSibling.classList.toggle('hidden'); this.querySelector('i').classList.toggle('rotate-180')">
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full mr-3" style="background-color: ${color}"></div>
                        <span>${party.nome}</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-sm font-normal text-text-light mr-4">${totalCandidatos} candidato(s)</span>
                        <span class="text-sm font-normal text-text-light mr-4">Total da Legenda: <strong class="text-main">${totalVotosPartido.toLocaleString('pt-BR')}</strong></span>
                        <i class="fa-solid fa-chevron-down transition-transform"></i>
                    </div>
                </button>
                <div class="p-2 hidden">
                    <div class="space-y-1">${candidatesHtml}</div>
                </div>
            `;
            container.appendChild(accordionItem);
        });

        const searchInput = document.getElementById('candidato-search');
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            document.querySelectorAll('.party-accordion-item').forEach(partyItem => {
                let partyHasVisibleCandidate = false;
                partyItem.querySelectorAll('.candidate-row').forEach(candidateRow => {
                    const candidateName = candidateRow.dataset.name;
                    if (candidateName.includes(searchTerm)) {
                        candidateRow.style.display = 'grid';
                        partyHasVisibleCandidate = true;
                    } else {
                        candidateRow.style.display = 'none';
                    }
                });
                
                if (partyHasVisibleCandidate) {
                    partyItem.style.display = 'block';
                } else {
                    partyItem.style.display = 'none';
                }
            });
        });
    }

    function changeTab(tabName) {
        document.getElementById('content-simulador').classList.toggle('hidden', tabName !== 'simulador');
        document.getElementById('content-candidatos').classList.toggle('hidden', tabName !== 'candidatos');
        
        document.querySelectorAll('#main-tabs button').forEach(button => {
            button.classList.remove('active');
            button.classList.add('text-text-light');
        });
        
        const activeButton = document.querySelector(`#main-tabs button[onclick="changeTab('${tabName}')"]`);
        activeButton.classList.add('active');
        activeButton.classList.remove('text-text-light');

        window.scrollTo(0, 0);
    }

    // =================================================================================
    // LÓGICA DO EDITOR DE LOGO E IMPRESSÃO
    // =================================================================================
    let logoEditorState = {
        image: null,
        scale: 1,
        offsetX: 0,
        offsetY: 0,
        isDragging: false,
        lastX: 0,
        lastY: 0
    };

    function initializeLogoEditor() {
        const logoContainer = document.getElementById('logo-container');
        const logoUpload = document.getElementById('logo-upload');
        logoContainer.addEventListener('click', () => logoUpload.click());
        logoUpload.addEventListener('change', handleLogoFileSelect);

        const savedLogo = localStorage.getItem('savedLogo');
        if (savedLogo) {
            document.getElementById('logo-img').src = savedLogo;
        }

        const canvas = document.getElementById('logo-adjust-canvas');
        canvas.addEventListener('mousedown', (e) => {
            logoEditorState.isDragging = true;
            logoEditorState.lastX = e.clientX;
            logoEditorState.lastY = e.clientY;
        });
        canvas.addEventListener('mouseup', () => logoEditorState.isDragging = false);
        canvas.addEventListener('mouseleave', () => logoEditorState.isDragging = false);
        canvas.addEventListener('mousemove', (e) => {
            if (!logoEditorState.isDragging || !logoEditorState.image) return;
            const dx = e.clientX - logoEditorState.lastX;
            const dy = e.clientY - logoEditorState.lastY;
            logoEditorState.lastX = e.clientX;
            logoEditorState.lastY = e.clientY;
            logoEditorState.offsetX += dx / logoEditorState.scale;
            logoEditorState.offsetY += dy / logoEditorState.scale;
            drawLogoOnCanvas();
        });

        document.getElementById('logo-zoom').addEventListener('input', (e) => {
            logoEditorState.scale = parseFloat(e.target.value);
            drawLogoOnCanvas();
        });
    }

    function handleLogoFileSelect(event) {
        const file = event.target.files[0];
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    logoEditorState.image = img;
                    openLogoEditor();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    }

    function openLogoEditor() {
        document.getElementById('logo-editor-modal').classList.remove('hidden');
        logoEditorState.scale = 1;
        logoEditorState.offsetX = 0;
        logoEditorState.offsetY = 0;
        document.getElementById('logo-zoom').value = 1;
        drawLogoOnCanvas();
    }

    function closeLogoEditor() {
        document.getElementById('logo-editor-modal').classList.add('hidden');
        logoEditorState.image = null;
    }

    function drawLogoOnCanvas() {
        const canvas = document.getElementById('logo-adjust-canvas');
        const ctx = canvas.getContext('2d');
        const { image, scale, offsetX, offsetY } = logoEditorState;
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        if (!image) return;

        ctx.save();
        ctx.fillStyle = '#1e293b';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        const canvasCenterX = canvas.width / 2;
        const canvasCenterY = canvas.height / 2;
        
        ctx.translate(canvasCenterX, canvasCenterY);
        ctx.scale(scale, scale);
        
        ctx.drawImage(image, -image.width / 2 + offsetX, -image.height / 2 + offsetY);
        
        ctx.restore();

        ctx.globalCompositeOperation = 'destination-in';
        ctx.beginPath();
        ctx.arc(canvasCenterX, canvasCenterY, canvas.width / 2, 0, Math.PI * 2);
        ctx.fill();

        ctx.globalCompositeOperation = 'source-over';
    }

    function saveLogo() {
        const canvas = document.getElementById('logo-adjust-canvas');
        const dataUrl = canvas.toDataURL('image/png');
        document.getElementById('logo-img').src = dataUrl;
        localStorage.setItem('savedLogo', dataUrl);
        closeLogoEditor();
    }
    
    function printReport() {
        window.print();
    }

    </script>
</body>
</html>
